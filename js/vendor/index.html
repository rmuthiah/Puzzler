<!DOCTYPE html>
<html>
	<body>
		<canvas id="canvas" width="600" height="400" style="background:#333" ></canvas>
		<script src="Box2d.min.js"></script>
		<script>
			var b2Vec2 = Box2D.Common.Math.b2Vec2
			,   b2AABB = Box2D.Collision.b2AABB
			,   b2BodyDef = Box2D.Dynamics.b2BodyDef
			,   b2Body = Box2D.Dynamics.b2Body
			,   b2FixtureDef = Box2D.Dynamics.b2FixtureDef
			,   b2Fixture = Box2D.Dynamics.b2Fixture
			,   b2World = Box2D.Dynamics.b2World
			,   b2MassData = Box2D.Collision.Shapes.b2MassData
			,   b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape
			,   b2CircleShape = Box2D.Collision.Shapes.b2CircleShape
			,   b2DebugDraw = Box2D.Dynamics.b2DebugDraw
			,   b2MouseJointDef =  Box2D.Dynamics.Joints.b2MouseJointDef
			,   b2RevoluteJointDef =  Box2D.Dynamics.Joints.b2RevoluteJointDef
			,   b2Transform = Box2D.Common.Math.b2Transform
			;

			var world = new b2World(new b2Vec2(0, 10), true);

			var bodyDef = new b2BodyDef;          // body definition
			bodyDef.type = b2Body.b2_dynamicBody; // body is movable
			bodyDef.position.x = 10;
			bodyDef.position.y = 10;
			bodyDef.angle = Math.PI / 2;

			var fixDef = new b2FixtureDef;        // fixture definition

			// fixture properties
			fixDef.density = 1.0;
			fixDef.friction = 0.5;
			fixDef.restitution = 0.2;

			// fixture shape
			fixDef.shape = new b2PolygonShape;
			fixDef.shape.SetAsBox(0.5, 7);

			var body1 = world.CreateBody(bodyDef);
			var fixture = body1.CreateFixture(fixDef);

			fixDef.shape = new b2PolygonShape;
			fixDef.shape.SetAsBox(0, 0);

			bodyDef.type = b2Body.b2_staticBody; // body is movable
			bodyDef.position.x = 10;
			bodyDef.position.y = 10;
			var body2 = world.CreateBody(bodyDef);
			body2.CreateFixture(fixDef);

			var joint = new b2RevoluteJointDef();
			joint.Initialize(body1, body2, body1.GetWorldCenter());
			world.CreateJoint(joint);
			
			fixDef.shape = new b2PolygonShape;
			fixDef.shape.SetAsBox(
			Math.random() + 0.1 //half width
			,  Math.random() + 0.1 //half height
			);

			bodyDef.type = b2Body.b2_dynamicBody; // body is movable
			bodyDef.position.x = 7;
			bodyDef.position.y = 0;
			world.CreateBody(bodyDef).CreateFixture(fixDef);

			/************ SETUP ************/
			fixDef = new b2FixtureDef;
			fixDef.density = 1.0;
			fixDef.friction = 0.5;
			fixDef.restitution = 0.2;

			bodyDef = new b2BodyDef;

			//create ground
			bodyDef.type = b2Body.b2_staticBody;
			fixDef.shape = new b2PolygonShape;
			fixDef.shape.SetAsBox(20, 2);
			bodyDef.position.Set(10, 400 / 30 + 1.8);
			world.CreateBody(bodyDef).CreateFixture(fixDef);
			bodyDef.position.Set(10, -1.8);
			world.CreateBody(bodyDef).CreateFixture(fixDef);
			fixDef.shape.SetAsBox(2, 14);
			bodyDef.position.Set(-1.8, 13);
			world.CreateBody(bodyDef).CreateFixture(fixDef);
			bodyDef.position.Set(21.8, 13);
			world.CreateBody(bodyDef).CreateFixture(fixDef);

			//setup debug draw
			var debugDraw = new b2DebugDraw();
			debugDraw.SetSprite(document.getElementById("canvas").getContext("2d"));
			debugDraw.SetDrawScale(30.0);
			debugDraw.SetFillAlpha(0.5);
			debugDraw.SetLineThickness(1.0);
			debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
			world.SetDebugDraw(debugDraw);

			function update() {
				world.Step(1 / 60, 10, 10);
				world.DrawDebugData();
				world.ClearForces();
			}
			window.setInterval(update, 1000 / 60);
		</script>
	</html>
